<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Learning App</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .navbar { background: white; border-radius: 15px; padding: 20px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .nav-links { display: flex; gap: 10px; }
        .nav-links a { color: #2c3e50; text-decoration: none; padding: 12px 20px; border-radius: 25px; transition: all 0.3s; background: #f8f9fa; font-weight: 500; }
        .nav-links a:hover { background: #e9ecef; transform: translateY(-2px); }
        .nav-links a.active { background: #16a085; color: white; }
        .user-info { color: #2c3e50; display: flex; align-items: center; gap: 15px; }
        .logout-btn { background: #e74c3c; color: white; border: none; padding: 8px 16px; border-radius: 20px; cursor: pointer; }
        .page { display: none; background: white; border-radius: 15px; padding: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .page.active { display: block; }
        .form-group { margin: 15px 0; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 600; color: #333; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: #16a085; }
        .btn { background: #16a085; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-size: 16px; transition: all 0.3s; }
        .btn:hover { background: #138d75; transform: translateY(-2px); }
        .btn-secondary { background: #95a5a6; }
        .btn-secondary:hover { background: #7f8c8d; }
        .btn-danger { background: #e74c3c; }
        .btn-danger:hover { background: #c0392b; }
        .word-card { background: #f8f9fa; border: 2px solid #e9ecef; border-radius: 10px; padding: 20px; margin: 15px 0; }
        .word-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .word-title { font-size: 24px; font-weight: bold; color: #2c3e50; }
        .word-actions { display: flex; gap: 10px; }
        .action-btn { background: #3498db; color: white; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-size: 14px; }
        .action-btn:hover { background: #2980b9; }
        .definition-section { background: #e8f5e8; border-left: 4px solid #16a085; padding: 15px; margin: 10px 0; border-radius: 0 8px 8px 0; }
        .loading { text-align: center; color: #7f8c8d; font-style: italic; }
        .error { background: #f8d7da; color: #721c24; padding: 10px; border-radius: 6px; margin: 10px 0; }
        .success { background: #d4edda; color: #155724; padding: 10px; border-radius: 6px; margin: 10px 0; }
        .flashcard { background: white; border-radius: 15px; padding: 40px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin: 20px 0; min-height: 300px; display: flex; flex-direction: column; justify-content: center; }
        .flashcard-word { font-size: 36px; font-weight: bold; color: #2c3e50; margin-bottom: 20px; }
        .flashcard-definition { font-size: 18px; color: #7f8c8d; margin-bottom: 20px; }
        .flashcard-example { font-size: 16px; color: #95a5a6; font-style: italic; }
        .quiz-question { background: #f8f9fa; border-radius: 10px; padding: 20px; margin: 15px 0; }
        .quiz-options { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0; }
        .quiz-option { background: white; border: 2px solid #ddd; border-radius: 8px; padding: 15px; cursor: pointer; transition: all 0.3s; }
        .quiz-option:hover { border-color: #16a085; background: #f0f9f6; }
        .quiz-option.selected { border-color: #16a085; background: #e8f5e8; }
        .quiz-option.correct { border-color: #27ae60; background: #d5f4e6; }
        .quiz-option.incorrect { border-color: #e74c3c; background: #fadbd8; }
        .progress-bar { background: #ecf0f1; border-radius: 10px; height: 20px; margin: 20px 0; overflow: hidden; }
        .progress-fill { background: #16a085; height: 100%; transition: width 0.3s; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 20px 0; }
        .stat-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; text-align: center; }
        .stat-number { font-size: 32px; font-weight: bold; margin-bottom: 5px; }
        .stat-label { font-size: 14px; opacity: 0.9; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Navigation -->
        <nav class="navbar">
            <div class="nav-links">
                <a href="#" onclick="showPage('dashboard')" class="nav-link active">Dashboard</a>
                <a href="#" onclick="showPage('vocab-bank')" class="nav-link">Vocab Bank</a>
                <a href="#" onclick="showPage('flashcard')" class="nav-link">Flashcards</a>
                <a href="#" onclick="showPage('quiz')" class="nav-link">Quiz</a>
                <a href="#" onclick="showPage('profile')" class="nav-link">Profile</a>
            </div>
            <div class="user-info">
                <span id="userName">Guest</span>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>
        </nav>

        <!-- Dashboard Page -->
        <div id="dashboard" class="page active">
            <h1>Welcome back <span id="dashboardUserName">Guest</span>! üëã</h1>
            <p style="color: #7f8c8d; margin-bottom: 30px;">Check your stats and vocabulary progress</p>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="thisWeekWords">27</div>
                    <div class="stat-label">This Week's Words</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="leaderboardRank">#4</div>
                    <div class="stat-label">Rank on Leaderboard</div>
                </div>
            </div>
            
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 15px; padding: 25px; margin: 30px 0; color: white;">
                <h3 style="margin-bottom: 15px;">üîí Unlock Quiz Mode</h3>
                <p style="margin-bottom: 15px;">Collect 4 more words to unlock quiz mode and test your knowledge!</p>
                <div class="progress-bar" style="background: rgba(255,255,255,0.3); margin: 15px 0;">
                    <div class="progress-fill" style="background: #ffd700; width: 60%;"></div>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                    <span>6 / 10 words</span>
                    <span>60% complete</span>
                </div>
                <button class="btn" style="background: #764ba2; border: 2px solid white;">üîí Need 4 more words</button>
            </div>
        </div>

        <!-- Vocabulary Bank Page -->
        <div id="vocab-bank" class="page">
            <button class="btn" onclick="showPage('dashboard')" style="margin-bottom: 20px;">‚Üê Dashboard</button>
            <h1>üìö Vocab Bank</h1>
            
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 15px; padding: 25px; margin: 20px 0; color: white;">
                <h3 style="margin-bottom: 15px;">üîí Unlock Quiz Mode</h3>
                <p style="margin-bottom: 15px;">Collect 4 more words to unlock quiz mode and test your knowledge!</p>
                <div class="progress-bar" style="background: rgba(255,255,255,0.3); margin: 15px 0;">
                    <div class="progress-fill" style="background: #ffd700; width: 60%;"></div>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                    <span>6 / 10 words</span>
                    <span>60% complete</span>
                </div>
                <button class="btn" style="background: #764ba2; border: 2px solid white;">üîí Need 4 more words</button>
            </div>
            
            <div class="form-group">
                <input type="text" id="searchWords" placeholder="Search words..." style="margin-bottom: 20px;">
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr auto; gap: 15px; margin-bottom: 20px;">
                <input type="text" id="newWord" placeholder="Word">
                <input type="text" id="newDefinition" placeholder="English Definition (optional)">
                <input type="text" id="newVietnameseDef" placeholder="Vietnamese Definition (optional)">
                <input type="text" id="newExample" placeholder="Example">
                <button class="btn" onclick="addWord()">Add Word</button>
            </div>
            
            <div id="wordsList"></div>
        </div>

        <!-- Flashcards Page -->
        <div id="flashcard" class="page">
            <h1>üÉè Flashcards</h1>
            <div id="flashcardContainer">
                <div class="loading">Loading flashcards...</div>
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn" onclick="previousCard()">‚Üê Previous</button>
                <button class="btn" onclick="flipCard()">Flip Card</button>
                <button class="btn" onclick="nextCard()">Next ‚Üí</button>
            </div>
        </div>

        <!-- Quiz Page -->
        <div id="quiz" class="page">
            <h1>üéØ Quiz</h1>
            <div id="quizContainer">
                <div class="loading">Loading quiz...</div>
            </div>
        </div>

        <!-- Profile Page -->
        <div id="profile" class="page">
            <h1>üë§ Profile</h1>
            <div class="form-group">
                <label>Name:</label>
                <input type="text" id="profileName" readonly>
            </div>
            <div class="form-group">
                <label>Email:</label>
                <input type="email" id="profileEmail" readonly>
            </div>
            <div class="form-group">
                <label>Member Since:</label>
                <input type="text" id="memberSince" readonly>
            </div>
            <button class="btn" onclick="updateProfile()">Update Profile</button>
        </div>
    </div>

    <script>
        let token = '';
        let currentUser = null;
        let words = [];
        let currentCardIndex = 0;
        let cardFlipped = false;
        let quizQuestions = [];
        let currentQuestionIndex = 0;
        let quizScore = 0;

        // Check if user is logged in
        function checkAuth() {
            const savedToken = localStorage.getItem('token');
            const savedUser = localStorage.getItem('user');
            
            if (savedToken && savedUser) {
                token = savedToken;
                currentUser = JSON.parse(savedUser);
                document.getElementById('userName').textContent = currentUser.name;
                loadWords();
                loadQuiz();
            } else {
                // Redirect to login if not authenticated
                window.location.href = 'login.html';
            }
        }

        // Navigation
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Remove active class from all nav links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(pageId).classList.add('active');
            
            // Add active class to clicked nav link
            event.target.classList.add('active');
            
            // Load page-specific data
            if (pageId === 'dashboard') {
                loadDashboard();
            } else if (pageId === 'vocab-bank') {
                loadWords();
            } else if (pageId === 'flashcard') {
                loadFlashcards();
            } else if (pageId === 'quiz') {
                loadQuiz();
            } else if (pageId === 'profile') {
                loadProfile();
            }
        }

        // Dashboard functions
        function loadDashboard() {
            if (currentUser) {
                document.getElementById('dashboardUserName').textContent = currentUser.name;
            }
            document.getElementById('thisWeekWords').textContent = words.length + Math.floor(Math.random() * 20);
            document.getElementById('leaderboardRank').textContent = '#' + Math.floor(Math.random() * 10);
        }

        function pronounceWord(word) {
            // Use Web Speech API for pronunciation
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(word);
                utterance.lang = 'en-US';
                speechSynthesis.speak(utterance);
            } else {
                alert('Speech synthesis not supported in this browser');
            }
        }

        // Vocabulary functions
        async function addWord() {
            const word = document.getElementById('newWord').value;
            const definition = document.getElementById('newDefinition').value;
            const example = document.getElementById('newExample').value;
            const difficulty = document.getElementById('newDifficulty').value;
            
            if (!word || !definition) {
                alert('Please fill in word and definition');
                return;
            }
            
            try {
                const response = await fetch('/api/vocab', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ word, definition, example, difficulty })
                });
                
                if (response.ok) {
                    document.getElementById('newWord').value = '';
                    document.getElementById('newDefinition').value = '';
                    document.getElementById('newExample').value = '';
                    loadWords();
                } else {
                    alert('Error adding word');
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        async function loadWords() {
            try {
                const response = await fetch('/api/vocab', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                words = await response.json();
                displayWords();
            } catch (error) {
                console.error('Error loading words:', error);
            }
        }

        function displayWords() {
            const container = document.getElementById('wordsList');
            if (words.length === 0) {
                container.innerHTML = '<div class="loading">No words added yet. Add your first word above!</div>';
                return;
            }
            
            container.innerHTML = words.map((word, index) => `
                <div class="word-card" style="background: #f8f9fa; border-left: 4px solid #16a085; border-radius: 0 10px 10px 0; padding: 20px; margin: 15px 0;">
                    <div class="word-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <div>
                            <div class="word-title" style="font-size: 24px; font-weight: bold; color: #2c3e50;">${word.word}</div>
                            ${word.pronunciation ? `<div style="color: #7f8c8d; font-size: 14px; margin-top: 5px;">${word.pronunciation}</div>` : ''}
                        </div>
                        <div class="word-actions" style="display: flex; gap: 10px;">
                            <button class="action-btn" onclick="pronounceWord('${word.word}')" style="background: #16a085;">üîä</button>
                            <button class="action-btn" onclick="getDefinition('${word.word}', ${index})" style="background: #16a085;">üìñ</button>
                            <button class="action-btn" onclick="editWord(${index})" style="background: #95a5a6;">‚úèÔ∏è</button>
                        </div>
                    </div>
                    ${word.definition ? `
                        <div style="margin-bottom: 10px;">
                            <strong style="color: #2c3e50;">English Definition:</strong>
                            <div style="margin-top: 5px; color: #555;">${word.definition}</div>
                        </div>
                    ` : ''}
                    ${word.synonyms ? `
                        <div style="margin-bottom: 10px;">
                            <strong style="color: #2c3e50;">Synonyms:</strong>
                            <div style="margin-top: 5px; color: #555;">${word.synonyms}</div>
                        </div>
                    ` : ''}
                    ${word.example ? `
                        <div style="margin-bottom: 10px;">
                            <strong style="color: #2c3e50;">Example:</strong>
                            <div style="margin-top: 5px; color: #555; font-style: italic;">${word.example}</div>
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        async function getDefinition(word, index) {
            try {
                const response = await fetch(`/api/auth/dictionary/${word}`);
                const data = await response.json();
                
                if (response.ok) {
                    // Update the word with new definition
                    words[index].definition = data.definition;
                    words[index].partOfSpeech = data.partOfSpeech;
                    words[index].pronunciation = data.pronunciation;
                    words[index].synonyms = data.synonyms;
                    displayWords();
                } else {
                    alert('Error getting definition: ' + data.error);
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        async function deleteWord(wordId) {
            if (!confirm('Are you sure you want to delete this word?')) return;
            
            try {
                const response = await fetch(`/api/vocab/${wordId}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (response.ok) {
                    loadWords();
                } else {
                    alert('Error deleting word');
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        // Flashcard functions
        function loadFlashcards() {
            if (words.length === 0) {
                document.getElementById('flashcardContainer').innerHTML = 
                    '<div class="loading">No words available for flashcards. Add some words first!</div>';
                return;
            }
            
            currentCardIndex = 0;
            cardFlipped = false;
            showCurrentCard();
        }

        function showCurrentCard() {
            const word = words[currentCardIndex];
            const container = document.getElementById('flashcardContainer');
            
            container.innerHTML = `
                <div class="flashcard">
                    <div class="flashcard-word">${word.word}</div>
                    ${word.partOfSpeech ? `<div style="color: #7f8c8d; font-style: italic;">${word.partOfSpeech}</div>` : ''}
                    ${cardFlipped ? `
                        <div class="flashcard-definition">${word.definition || 'No definition available'}</div>
                        <div class="flashcard-example">${word.example || 'No example available'}</div>
                    ` : `
                        <div style="margin-top: 20px;">
                            <button class="btn" onclick="getDefinition('${word.word}', ${currentCardIndex})">üìñ Get Definition</button>
                        </div>
                    `}
                </div>
                <div style="text-align: center; margin-top: 10px;">
                    Card ${currentCardIndex + 1} of ${words.length}
                </div>
            `;
        }

        function flipCard() {
            cardFlipped = !cardFlipped;
            showCurrentCard();
        }

        function previousCard() {
            if (currentCardIndex > 0) {
                currentCardIndex--;
                cardFlipped = false;
                showCurrentCard();
            }
        }

        function nextCard() {
            if (currentCardIndex < words.length - 1) {
                currentCardIndex++;
                cardFlipped = false;
                showCurrentCard();
            }
        }

        // Quiz functions
        function loadQuiz() {
            if (words.length < 4) {
                document.getElementById('quizContainer').innerHTML = 
                    '<div class="loading">Need at least 4 words to create a quiz. Add more words first!</div>';
                return;
            }
            
            // Create quiz questions
            quizQuestions = [];
            const shuffledWords = [...words].sort(() => Math.random() - 0.5);
            
            for (let i = 0; i < Math.min(5, shuffledWords.length); i++) {
                const correctWord = shuffledWords[i];
                const wrongWords = shuffledWords.filter(w => w.id !== correctWord.id).slice(0, 3);
                const allOptions = [correctWord, ...wrongWords].sort(() => Math.random() - 0.5);
                
                quizQuestions.push({
                    question: `What is the definition of "${correctWord.word}"?`,
                    options: allOptions,
                    correct: correctWord
                });
            }
            
            currentQuestionIndex = 0;
            quizScore = 0;
            showCurrentQuestion();
        }

        function showCurrentQuestion() {
            if (currentQuestionIndex >= quizQuestions.length) {
                showQuizResults();
                return;
            }
            
            const question = quizQuestions[currentQuestionIndex];
            const container = document.getElementById('quizContainer');
            
            container.innerHTML = `
                <div class="progress-bar">
                    <div class="progress-fill" style="width: ${(currentQuestionIndex / quizQuestions.length) * 100}%"></div>
                </div>
                <div class="quiz-question">
                    <h3>Question ${currentQuestionIndex + 1} of ${quizQuestions.length}</h3>
                    <p>${question.question}</p>
                </div>
                <div class="quiz-options">
                    ${question.options.map((option, index) => `
                        <div class="quiz-option" onclick="selectAnswer(${index})">
                            ${option.definition || 'No definition available'}
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function selectAnswer(optionIndex) {
            const question = quizQuestions[currentQuestionIndex];
            const selectedOption = question.options[optionIndex];
            const isCorrect = selectedOption.id === question.correct.id;
            
            if (isCorrect) {
                quizScore++;
            }
            
            // Show correct/incorrect feedback
            const options = document.querySelectorAll('.quiz-option');
            options.forEach((option, index) => {
                option.onclick = null; // Disable further clicks
                if (question.options[index].id === question.correct.id) {
                    option.classList.add('correct');
                } else if (index === optionIndex && !isCorrect) {
                    option.classList.add('incorrect');
                }
            });
            
            // Move to next question after delay
            setTimeout(() => {
                currentQuestionIndex++;
                showCurrentQuestion();
            }, 2000);
        }

        function showQuizResults() {
            const percentage = Math.round((quizScore / quizQuestions.length) * 100);
            document.getElementById('quizContainer').innerHTML = `
                <div class="quiz-question">
                    <h2>Quiz Complete!</h2>
                    <div class="stat-card" style="margin: 20px 0;">
                        <div class="stat-number">${quizScore}/${quizQuestions.length}</div>
                        <div class="stat-label">Correct Answers</div>
                    </div>
                    <div class="stat-card" style="margin: 20px 0;">
                        <div class="stat-number">${percentage}%</div>
                        <div class="stat-label">Accuracy</div>
                    </div>
                    <button class="btn" onclick="loadQuiz()">Take Another Quiz</button>
                </div>
            `;
        }

        // Profile functions
        function loadProfile() {
            if (currentUser) {
                document.getElementById('profileName').value = currentUser.name;
                document.getElementById('profileEmail').value = currentUser.email;
                document.getElementById('memberSince').value = new Date(currentUser.createdAt).toLocaleDateString();
            }
        }

        function updateProfile() {
            alert('Profile update functionality would be implemented here');
        }

        // Logout
        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            window.location.href = 'login.html';
        }

        // Initialize app
        checkAuth();
    </script>
</body>
</html>
